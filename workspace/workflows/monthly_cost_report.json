{
  "name": "Monthly Cost Report",
  "description": "Generate a detailed monthly cost report with breakdown by service, trends, and top resources",
  "language": "javascript",
  "createdAt": "2025-10-09T00:00:00.000Z",
  "tags": ["reporting", "monthly", "costs"],
  "code": "// Monthly Cost Report Generator\nconst athena = new AWS.Athena({ region: 'ap-south-1' });\n\n// Get current and previous month dates\nconst now = new Date();\nconst currentMonth = new Date(now.getFullYear(), now.getMonth(), 1);\nconst previousMonth = new Date(now.getFullYear(), now.getMonth() - 1, 1);\nconst currentMonthStr = currentMonth.toISOString().split('T')[0];\nconst previousMonthStr = previousMonth.toISOString().split('T')[0];\n\nconsole.log(`Generating cost report for ${currentMonthStr}`);\nconsole.log('============================================\\n');\n\n// Query for service-level costs\nconst query = `\nSELECT \n  \\\"product/productname\\\" as service,\n  ROUND(SUM(\\\"lineitem/unblendedcost\\\"), 2) as cost,\n  COUNT(DISTINCT \\\"lineitem/resourceid\\\") as resource_count\nFROM \\\"raw-data-v1\\\".\\\"raw_aws_amnic\\\"\nWHERE \\\"lineitem/usagestartdate\\\" >= DATE('${currentMonthStr}')\n  AND \\\"lineitem/unblendedcost\\\" > 0\nGROUP BY \\\"product/productname\\\"\nORDER BY cost DESC\nLIMIT 10\n`;\n\n// Execute query\nconst params = {\n  QueryString: query,\n  QueryExecutionContext: { Database: 'raw-data-v1' },\n  ResultConfiguration: { OutputLocation: 's3://amnic-athena-result-in/finops-agent/' }\n};\n\nathena.startQueryExecution(params, (err, data) => {\n  if (err) {\n    console.error('Query failed:', err);\n    return;\n  }\n  \n  const queryId = data.QueryExecutionId;\n  console.log('Query executed:', queryId);\n  console.log('\\nTop 10 Services by Cost:');\n  console.log('Note: Run this workflow to see results\\n');\n});"
}
